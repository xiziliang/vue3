<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    #modeBtn::after {
        content: 'ğŸŒ';
    }

    body.night #modeBtn::after {
        content: 'ğŸŒœ';
    }

    #panel {
        display: inline-block;
        width: 360px;
        height: 360px;
        background: hsl(0, 50%, 50%);
    }

    #panel2 {
        width: 100%;
        height: 0;
        padding-bottom: 100%;
    }
</style>

<body>
    <header>
        header (Click here)
    </header>
    <main>
        <button id="modeBtn" class="">
            Main (MouseOver)
        </button>
    </main>
    <footer>
        footer (Click here)
    </footer>
    <div id="panel"></div>
    <div id="panel2">
        <canvas></canvas>
    </div>
</body>
<script>
    // ------ ä»£ç çš„å°è£…ä»¥åŠæ­£ç¡®æ€§ -----start-------
    function* shuffle(items) {
        items = [...items];
        for (let i = items.length; i > 0; i--) {
            const idx = Math.floor(Math.random() * i);
            [items[idx], items[i - 1]] = [items[i - 1], items[idx]]; // items[idx]å’Œitems[i - 1]åšä¸€ä¸ªäº¤æ¢ï¼Œä¸éœ€è¦ç¬¬ä¸‰ä¸ªå…ƒç´ 
            console.log([items[idx], items[i - 1]]);
            yield items[i - 1];
        }
    }

    let items = [...new Array(100).keys()];

    let n = 1;
    // 100ä¸ªå·éšæœºæŠ½å–5ä¸ª
    for (let item of shuffle(items)) { // Generator å‡½æ•°å¯ä»¥é€šè¿‡for of  éå†ï¼Œæœ‰å¤šå°‘yieldéå†å¤šå°‘æ¬¡
        console.log(item);
        if (n++ >= 5) break;
    }
    // ------ ä»£ç çš„å°è£…ä»¥åŠæ­£ç¡®æ€§ -----end-------

    //---------è¿‡ç¨‹æŠ½è±¡ --------start------------
    function once(fn, replacer = null) {
        /** é«˜é˜¶å‡½æ•°ä¸­ç¬¬ä¸€ä¸ªè¿”å›çš„å‡½æ•°çš„å…¥å‚æ¥æº
         * @param args //å‚æ•°æ˜¯returnçš„å‡½æ•°è¿›è¡Œçš„å…¥å‚ï¼Œfn å’Œ replacerçš„å…¥å‚ä¸åœ¨argsä¸­ï¼Œä½†æ˜¯returnçš„å‡½æ•°è¿›è¡Œçš„å…¥å‚å¯ä»¥åœ¨fn å’Œ replacerä¸­è¿›è¡Œè¯»å–,æ˜¯å› ä¸º ret = fn.apply(this, args);
         */
        return function (...args) {
            if (fn) {
                console.log(args, this)
                const ret = fn.apply(this, args);
                fn = null;
                return ret;
            }
            if (replacer) {
                return replacer.apply(this, args);
            }
        };
    }

    // const obj = {
    //     init: once(() => {
    //         console.log('Initializer has been called.');
    //     }, () => {
    //         throw new Error('This method should be called only once.');
    //     }),
    // }

    // obj.init(1,1,3,3);
    // obj.init();
    const fn = (...a) => {
        console.log(a)
    }
    const error = (...b) => {
        console.log('error', b)
    }
    const res = once(fn, error);
    res('a', 'b');
    res(3, 2, 1);
    //---------è¿‡ç¨‹æŠ½è±¡ --------end------------

    //---------é˜²æŠ–èŠ‚æµ--------start----------
    // first èŠ‚æµè£…é¥°å™¨
    const panel = document.getElementById('panel');
    panel.addEventListener('mousemove', throttle((e) => {
        const {
            x,
            y
        } = e;
        e.target.style.background = `linear-gradient(${y}deg, 
    hsl(0, 50%, 50%),
    hsl(${0.5 * x}, 50%, 50%))`;
    }, 1000));

    function throttle(fn, ms = 1000) {
        let throttleTimer = null;
        return function (...args) {
            console.log(args)
            if (!throttleTimer) {
                // const ret = fn.apply(this, args);
                throttleTimer = setTimeout(() => {
                    throttleTimer = null;
                }, ms);
                return fn.apply(this, args);
            }
        };
    }
    // second é˜²æŠ–è£…é¥°å™¨
    const panel2 = document.getElementById('panel2');
    const canvas = document.querySelector('canvas');

    function resize() {
        canvas.width = panel2.clientWidth;
        canvas.height = panel2.clientHeight;
    }

    function draw() {
        const context = canvas.getContext('2d');
        const radius = canvas.width / 2;
        context.save();
        context.translate(radius, radius);
        for (let i = radius; i >= 0; i -= 5) {
            context.fillStyle = `hsl(${i % 360}, 50%, 50%)`;
            context.beginPath();
            context.arc(0, 0, i, i, 0, Math.PI * 2);
            context.fill();
        }
        context.restore();
    }

    resize();
    draw();

    let debounceTimer = null;
    window.addEventListener('resize', debounce(() => {
        resize();
        draw();
    }, 500));

    function debounce(fn, ms) {
        let debounceTimer = null;
        return function (...args) {
            if (debounceTimer) clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                fn.apply(this, args);
            }, ms);
        };
    }
    //---------é˜²æŠ–èŠ‚æµ--------end----------

    //---------å‡½æ•°æ‹¦æˆªå™¨-------start-----------

    // import {
    //     foo,
    //     bar
    // } from './foo';
    // ç”¨é«˜é˜¶å‡½æ•°ä¿®é¥°
    // const _foo = deprecate(foo, 'foo', 'newFoo');
    // const _bar = deprecate(bar, 'bar', 'newBar');

    // é‡æ–°å¯¼å‡ºä¿®é¥°è¿‡çš„API
    // export {
    //     foo: _foo,
    //     bar: _bar,
    // }
    // ----------------------------------------------
    // å‡½æ•°æ‹¦æˆªå™¨ deprecate
    function deprecate(fn, oldApi, newApi) {
        const message = `The ${oldApi} is deprecated.
Please use the ${newApi} instead.`;
        const notice = once(console.warn);

        return function (...args) {
            notice(message);
            fn.apply(this, args);
        }
    }
    // ----------------------------------------------
    // apply call bind 
    // æ‰§è¡ŒåŒºåˆ«ï¼šfn.applyï¼Œfn.call è¿”å›çš„æ˜¯fnæ‰§è¡Œå®Œçš„ç»“æœï¼Œ fn.bind è¿”å›çš„æœªæ‰§è¡Œçš„fnå‡½æ•°ï¼Œåªæ˜¯æ”¹å˜äº†å†…éƒ¨çš„thisæŒ‡å‘
    // ä¼ å‚åŒºåˆ«: fn.apply(this,arr) applyå¦‚æœä¼ çš„æ˜¯æ•°ç»„ï¼Œfnæ¥æ”¶çš„æ˜¯å°†arræ‹†å¼€åä¼ è¿‡æ¥çš„å€¼ï¼Œcallå¦‚æœä¼ çš„æ˜¯æ•°ç»„ï¼Œfnæ¥æ”¶çš„æ˜¯å°†arrè¿™ä¸ªæ•°ç»„ã€‚bindä¹Ÿä¸€æ ·æ˜¯æ¥æ”¶arrè¿™ä¸ªæ•°ç»„ã€‚
    // å‡½æ•°æ‹¦æˆªå™¨ intercept
    function intercept(fn, {
        beforeCall = null,
        afterCall = null
    }) {
        return function (...args) {
            console.log('intercept', args)
            debugger
            if (!beforeCall || beforeCall.call(this, args) !== false) { // å¯ä»¥é€šè¿‡ beforeCall  return false ç»„é˜»æ­¢fnæ‰§è¡Œ
                // å¦‚æœbeforeCallè¿”å›falseï¼Œä¸æ‰§è¡Œåç»­å‡½æ•°
                console.log(args)
                const ret = fn.apply(this, args);
                if (afterCall) return afterCall.call(this, ret);
                return ret;
            }
        };
    }

    // function sum(list) {
    //     console.log(list)
    //     return list.reduce((a, b) => a + b)
    // }
    // sum = intercept(sum, {
    //     beforeCall(args) {
    //         console.log(`The argument is ${args}`);
    //         console.time('sum'); // ç›‘æ§æ€§èƒ½
    //     },
    //     afterCall(res) {
    //         console.log(`The resulte is ${res}`);
    //         console.timeEnd('sum');
    //     }
    // })
    // sum(1, 2, 3, 4, 5);

    // å¯ä»¥è°ƒæ•´å¾ªåº  é‡æ–°å®šä¹‰äº†ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨å‡½æ•°mySetTimeoutï¼Œå®ƒçš„å‚æ•°æ°å¥½å’ŒsetTimeoutç›¸åã€‚
    // function setTimeout (fn,ms) {
    //     return setTimeout(fn,ms)
    // }
    const mySetTimeout = intercept(setTimeout, {
        beforeCall(args) {
            [args[0], args[1]] = [args[1], args[0]];
        }
    });

    mySetTimeout(1000, () => {
        console.log('done');
    });
    //---------å‡½æ•°æ‹¦æˆªå™¨-------end-------------

    //-----å‡½æ•°çš„çº¯åº¦ã€å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§----start--------

    // å¤šå†™çº¯å‡½æ•°
    function batch(fn) {
        return function (subject, ...args) { // ...args = [xxx,xx,x]
            if (Array.isArray(subject)) {
                return subject.map((item) => {
                    return fn.call(this, item, ...args) // ...args == å±•å¼€æ•°ç»„ args
                })
            }
            return fn.call(this, subject, ...args);
        }
    }


    //-----å‡½æ•°çš„çº¯åº¦ã€å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§----end--------


    //--------é«˜é˜¶å‡½æ•°çš„èŒƒå¼---------start----------
    // é«˜é˜¶å‡½æ•°çš„ç­‰é˜¶èŒƒå¼ HOFO
    function HOFO(fn) {
        return function (...args) {
            return fn.apply(this, args);
        }
    }

    // é«˜é˜¶å‡½æ•°çš„é€’å½’èŒƒå¼ continous
    function continous(fn) {
        return function (...args) {
            return args.reduce((a, b) => fn(a, b))
        }
    }
    const add = continous((a, b) => a + b);
    console.log(add(1, 2, 3, 4)); // 1 + 2 + 3 + 4 = 10

    // é«˜é˜¶å‡½æ•°ä»»æ„ç»„åˆèŒƒå¼
    function pipe(...fns) {
        return function (input) {
            return fns.reduce((a, b) => {
                return b.call(this, a);
            }, input) // input åˆå§‹å€¼
        }
    }

    const double = (x) => x * 2;
    const half = (x) => x / 2;
    const pow2 = (x) => x ** 2;

    const cacl = pipe(double, pow2, half);
    const result = cacl(10); // (10 * 2) ** 2 / 2 = 200
    //--------é«˜é˜¶å‡½æ•°çš„èŒƒå¼---------end----------
</script>

</html>